!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.koeasyui={})}(this,function(e){"use strict";function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var t=function(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e};function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e){d(this,o),this.ko=e,this.jquery=$}function i(e){d(this,i),this.type=e}var s;function u(e){var t={linkbutton:"<a></a>",layout:'<div style="height:100%" >\x3c!-- ko template:{ nodes:$componentTemplateNodes,data:$context.$parent } --\x3e\x3c!-- /ko --\x3e</div>',dialog:"<div>\x3c!-- ko template:{ nodes:$componentTemplateNodes,data:$context.$parent } --\x3e\x3c!-- /ko --\x3e</div>",datagrid:"<table></table>",treegrid:"<table></table>"}[e];return t||(t="<div></div>"),t}(s||(s={})).CompPrefix="ko-";var r,l,v=Array.prototype.slice;(l=r||(r={}))[l.easyui=1]="easyui",l[l.norm=8]="norm";var h=(p(m,i),t(m,[{key:"createOptionsCore",value:function(e){var n=this,a=null;if(e){var t=e.viewModel||null;a=ko.toJS(e),t&&(a.viewModel=t),$.map(a,function(e,t){"on"==t.substring(0,2)&&$.isFunction(e)&&(a[t]=e.bind(n))})}return a}},{key:"createOptions",value:function(e){return this.createOptionsCore(e)}},{key:"paint",value:function(e){var t=this.createOptions(e);this.$dom[this.name](t)}},{key:"resetComp",value:function(e){var t=this.$dom.closest(""+s.CompPrefix+this.name);0==t.length&&(t=this.$parent),this.destroy&&this.destroy(this);var n=$(u(this.name));t.append(n),this.$dom=n}}]),m);function m(e,t,n){d(this,m);var a=c(this,(m.__proto__||Object.getPrototypeOf(m)).call(this,r.easyui));a.props=t,a.name=e,a.$dom=$($(n.element)[0].firstChild),a.$parent=a.$dom.parent();var o=ko.contextFor(n.element);return $.data(n.element,o),a.koContext=o,a}var f=(p(b,h),t(b,[{key:"bindMethods",value:function(){var e=this,t=this.getMethodKeys();$.map(t,function(t){e[t]=function(){var e=v.call(arguments);$.messager[t].apply($.messager,e)}})}},{key:"getMethodKeys",value:function(){var t=new Array;return $.map(Object.getOwnPropertyNames($.messager),function(e){"defaults"!=e&&t.push(e)}),t}},{key:"paint",value:function(e){var t=this.createOptions(e);$.extend($.messager.defaults,t)}},{key:"repaint",value:function(e){this.paint(e)}}]),b);function b(e,t){d(this,b);var n=c(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"messager",Object.getOwnPropertyNames($.messager.defaults),t));return n.bindMethods(),n}var y=(p(g,i),t(g,[{key:"paint",value:function(e){}}]),t(g,[{key:"repaint",value:function(e){}},{key:"addDialog",value:function(e){var t,n=e||{},a=this,o="dialogs_"+ko.unwrap(this.list).length,i=n.onClose;n.onClose=(t=o,function(){a.removeDialog(t,this.$dom[0]),i&&i.call(a,t)}),n.$key=o,this.list.push({name:"ko-dialog",params:{options:n},key:o})}},{key:"removeDialog",value:function(t,e){ko.cleanNode(e.firstElementChild),this.list.remove(function(e){return e.key===t})}}],[{key:"getTemplate",value:function(){return'<div data-bind="foreach:{data:list}" ><div data-bind="component:$data,attr:{id:(\'dialogs_\' + $index())}" ></div></div>'}}]),g);function g(e,t){d(this,g);var n=c(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,r.norm));return n.name="dialogs",n.bindContext=ko.contextFor(t.element),n.list=ko.observableArray(),n}var k=(p(x,h),t(x,[{key:"bindMethods",value:function(){var e=this,t=this.getMethodKeys();$.map(t,function(t){e[t]=function(){var e=v.call(arguments);e.unshift(t),this.$dom[this.name].apply(this.$dom,e)}})}},{key:"getMethodKeys",value:function(){var t=new Array;return $.map(Object.getOwnPropertyNames($.fn.desktop.methods),function(e){"defaults"!=e&&t.push(e)}),t}},{key:"paint",value:function(e){var t=this.createOptions(e);t=$.extend($.fn.desktop.defaults,t),function e(t,n,a){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,a)}if("value"in o)return o.value;var r=o.get;return void 0!==r?r.call(a):void 0}(x.prototype.__proto__||Object.getPrototypeOf(x.prototype),"paint",this).call(this,t)}},{key:"repaint",value:function(e){this.paint(e)}}]),x);function x(e,t){d(this,x);var n=c(this,(x.__proto__||Object.getPrototypeOf(x)).call(this,"desktop",Object.getOwnPropertyNames($.fn.desktop.defaults),t));return n.bindMethods(),n}var O=(t(w,null,[{key:"createEasyui",value:function(o,r,i,s,u){function l(e,t){d(this,l);var n=c(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,o.toLowerCase(),r,t));n.params=e,n.params.options||(n.params.options={}),n.$dom=$($(t.element)[0].firstChild);var a=n;return $.map(Object.getOwnPropertyNames(i),function(e){if(!$.isNumeric(e))return!0;var t=i[e];a[t]=function(){var e=v.call(arguments);return u.extend(a.name,e[0],a.koContext),e.unshift(t),s.execute(a.name,t,a.$dom,e)}}),n}return p(l,h),t(l,[{key:"bindChangeEvent",value:function(n,e){var a=!1;if($.map(r,function(e,t){if("onChange"==e)return!(a=!0)}),n.value&&ko.isObservable(n.value)&&a){var o=e.onChange,i=this;e.onChange=function(e,t){n.value._latestValue=e,o&&o.call(i,e,t)}}}},{key:"createOptions",value:function(e){var t=this.createOptionsCore(e);return e&&this.bindChangeEvent(e,t),u.extend(this.name,t,this.koContext),t}},{key:"repaint",value:function(e){this.resetComp(e),this.paint(e)}},{key:"dispose",value:function(){console.log("dispose "+this.name),this.computedObservable&&this.computedObservable.dispose(),this.params.options.dispose?this.params.options.dispose.apply(this):this.destroy&&this.destroy()}}]),l}}]),w);function w(){d(this,w)}var _={tooltip:{content:"update"},textbox:{value:"setValue"},panel:{title:"setTitle"},passwordbox:{value:"setValue"},combo:{value:"setValue"},combobox:{value:"setValue",data:"loadData"},combotree:{value:"setValue",data:"loadData"},combogrid:{value:"setValue",data:"loadData"},combotreegrid:{value:"setValue",data:"loadData"},tagbox:{value:"setValue",data:"loadData"},numberbox:{value:"setValue"},datebox:{value:"setValue"},datetimebox:{value:"setValue"},datetimespinner:{value:"setValue"},spinner:{value:"setValue"},numberspinner:{value:"setValue"},timespinner:{value:"setValue"},slider:{value:"setValue"},filebox:{value:"setValue"},datagrid:{data:"loadData"},datalist:{data:"loadData"},propertygrid:{data:"loadData"},tree:{data:"loadData"},treegrid:{data:"loadData"}},C={pagination:{dependencies:["linkbutton"]},datagrid:{dependencies:["panel","resizable","linkbutton","pagination"]},treegrid:{dependencies:["datagrid"]},propertygrid:{dependencies:["datagrid"]},datalist:{dependencies:["datagrid"]},window:{dependencies:["resizable","draggable","panel"]},dialog:{dependencies:["linkbutton","window"]},messager:{dependencies:["linkbutton","window","progressbar"]},layout:{dependencies:["resizable","panel"]},tabs:{dependencies:["panel","linkbutton"]},menubutton:{dependencies:["linkbutton","menu"]},splitbutton:{dependencies:["menubutton"]},accordion:{dependencies:["panel"]},textbox:{dependencies:["validatebox","linkbutton"]},filebox:{dependencies:["textbox"]},combo:{dependencies:["panel","textbox"]},combobox:{dependencies:["combo"]},combotree:{dependencies:["combo","tree"]},combogrid:{dependencies:["combo","datagrid"]},combotreegrid:{dependencies:["combo","treegrid"]},validatebox:{dependencies:["tooltip"]},numberbox:{dependencies:["textbox"]},searchbox:{dependencies:["menubutton","textbox"]},spinner:{dependencies:["textbox"]},numberspinner:{dependencies:["spinner","numberbox"]},timespinner:{dependencies:["spinner"]},tree:{dependencies:["draggable","droppable"]},datebox:{dependencies:["calendar","combo"]},datetimebox:{dependencies:["datebox","timespinner"]},slider:{dependencies:["draggable"]}};var P=(t(j,[{key:"execute",value:function(n,e,t,a){var o=!1;if($.map(this.noSupportDestroy,function(e,t){if(e==n)return!(o=!0)}),"destroy"!=e||!o){var i=function n(t,a,o,i){var e=i.fn[t].methods,r=null;if($.map(Object.getOwnPropertyNames(e),function(e){if(e==a)return r=t,!1}),!r){var s=C[t]?C[t].dependencies:null;s&&$.map(s,function(e){if(!r){var t=n(e,a,o,i);t&&o&&0<=Object.getOwnPropertyNames(o).join(",").indexOf(t)&&(r=t)}})}return r}(n,e,this.deps[n],this.jquery);if(i&&i!=n&&this.deps[n]){var r=t[n].apply(t,[this.deps[n][i]]),s=this.jquery(r[0]);return r[i].apply(s,a)}return t[n].apply(t,a)}}}]),j);function j(e){d(this,j),this.jquery=e,this.deps={combo:{textbox:"textbox"},combogrid:{datagrid:"grid"},combotreegrid:{treegrid:"grid"},combotree:{tree:"tree"},datagrid:{panel:"getPanel",pagination:"getPager"},propertygrid:{panel:"getPanel"},treegrid:{panel:"getPanel"},datetimebox:{spinner:"spinner"},datebox:{calendar:"calendar"},searchbox:{textbox:"textbox",menu:"menu"},datalist:{panel:"getPanel",pagination:"getPager"}},this.noSupportDestroy=["layout","tabs"]}var M=(t(N,[{key:"execute",value:function(e,t,n,a){return this.executes.execute(e,t,n,a)}}]),N);function N(e){d(this,N),this.opt=e,this.executes=new P(this.opt.jquery)}var V=(t(D,[{key:"generate",value:function(t,n,a){var o=!0,i=this;this._touchMount(t,n,a);var r=this._getObservableKeys(n);return n.options&&ko.computed(function(){var e=i._getChangeObservable(n,r,a);o?o=!1:0<e.length&&i._touchPaint(t,n,a,e,function(){a.repaint&&a.repaint(n.options)})}),a}},{key:"_getObservableKeys",value:function(e){var n=new Array,a=e.options;return a&&$.map(Object.getOwnPropertyNames(a),function(e){var t=a[e];ko.isObservable(t)&&n.push(e)}),n}},{key:"_getChangeObservable",value:function(e,t,n){var a=e.options,o=new Array;return $.map(t,function(e){var t=a[e];ko.unwrap(t),ko.isObservable(t)&&t.hasChanged()&&o.push(t)}),o}},{key:"_touchMount",value:function(e,t,n){n.beforeMount&&n.beforeMount(t,e),n.paint&&n.paint(t.options||{}),n.afterMount&&n.afterMount(t,e)}},{key:"_touchPaint",value:function(e,t,n,a,o){n.beforePaint&&n.beforePaint(t,e,a),o&&o(),n.afterPaint&&n.afterPaint(t,e)}}]),D);function D(e){d(this,D),this.option=e}var q=(t(E,[{key:"extend",value:function(e,t,n){var a=this._getEventName(e);a&&this._extendOption(a,t,n)}},{key:"_extendOption",value:function(e,t,n){var a=this;if(t&&t.viewModel){var o=t[e],i=void 0;t[e]=function(){i&&(ko.removeNode(this.firstChild),$(this).append(t.content)),i=n.createChildContext(t.viewModel,void 0,function(e){}),a.ko.applyBindingsToDescendants(i,this),o&&o.apply(i.$data,arguments)}}}}]),E);function E(e){d(this,E),this._getEventName=function(e){var t=null;switch(e){case"window":case"dialog":case"layout":case"panel":case"tabs":case"accordion":t="onBeforeOpen"}return t},this.option=e,this.jquery=e.jquery,this.ko=e.ko}var A=(p(T,V),t(T,[{key:"registerPlugins",value:function(){var r=this;this.jquery.fn.datagrid.defaults.columns=[[]],this.jquery.fn.datagrid.defaults.frozenColumns=[[]],this._extendPanelEvent();var e=this.easyui.plugins;$.map(e,function(e){var t=r.jquery.fn[e].defaults,n=r.jquery.fn[e].methods,a=function t(e){var n=C[e],a=[];return n&&n.dependencies&&$.map(n.dependencies,function(e){C[e]&&(a=a.concat(t(e))),a.push(e)}),a}(e);if(t){var o=Object.getOwnPropertyNames(t),i=Object.getOwnPropertyNames(n);a&&($.map(a,function(e){var t=r.jquery.fn[e].methods;i=i.concat(Object.getOwnPropertyNames(t))}),i=function(e){for(var t=new Array,n=Object.create({}),a=0;a<e.length;++a){var o=e[a];n[o]||(t.push(o),n[o]=!0)}return t}(i)),r.option.ko.components.register(""+s.CompPrefix+e,{template:u(e),viewModel:O.createEasyui(e,o,i,r.executeProvider,r.extendBind)})}})}},{key:"generate",value:function(t,n,a){var o=!0,i=this;this._touchMount(t,n,a);var r=this._getObservableKeys(n);return n.options&&(a.computedObservable=ko.computed({read:function(){var e=i._getChangeObservable(n,r,a);o?o=!1:0<e.changeOpts.length&&i._touchPaint(t,n,a,e,function(){e.changeOpts.length==e.reflows.length?$.map(e.reflows,function(e){a[e.methodName](e.val)}):a.repaint(n.options)})},disposeWhenNodeIsRemoved:!0})),a}},{key:"_getChangeObservable",value:function(e,t,a){var o=e.options,i=new Array,r=new Array;return $.map(t,function(e){var t=o[e],n=ko.unwrap(t);ko.isObservable(t)&&t.hasChanged()&&(i.push(t),_[a.name]&&_[a.name][e]&&r.push({val:n,methodName:_[a.name][e]}))}),{changeOpts:i,reflows:r}}},{key:"_extendPanelEvent",value:function(){$.fn.panel.defaults.onOpen=function(){},$.fn.linkbutton.methods.destroy=function(e){e.unbind(".linkbutton"),e.remove()}}}]),T);function T(e){d(this,T);var t=c(this,(T.__proto__||Object.getPrototypeOf(T)).call(this,e));return t.jquery=e.jquery,t.easyui=t.jquery.parser,t.executeProvider=new M(e),t.extendBind=new q(e),t.registerPlugins(),t}t(F,null,[{key:"createEasyui",value:function(o,r,i,s,u){function l(e,t){d(this,l);var n=c(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,o.toLowerCase(),r,t));n.params=e,n.params.options||(n.params.options={}),n.$dom=$($(t.element)[0].firstChild);var a=n;return $.map(Object.getOwnPropertyNames(i),function(e){if(!$.isNumeric(e))return!0;var t=i[e];a[t]=function(){var e=v.call(arguments);return u.extend(a.name,e[0],a.koContext),e.unshift(t),s.execute(a.name,t,a.$dom,e)}}),n}return p(l,h),t(l,[{key:"bindChangeEvent",value:function(n,e){var a=!1;if($.map(r,function(e,t){if("onChange"==e)return!(a=!0)}),n.value&&ko.isObservable(n.value)&&a){var o=e.onChange,i=this;e.onChange=function(e,t){n.value._latestValue=e,o&&o.call(i,e,t)}}}},{key:"createOptions",value:function(e){var t=this.createOptionsCore(e);return e&&this.bindChangeEvent(e,t),u.extend(this.name,t,this.koContext),t}},{key:"repaint",value:function(e){this.resetComp(e),this.paint(e)}},{key:"dispose",value:function(){console.log("dispose "+this.name),this.computedObservable&&this.computedObservable.dispose(),this.params.options.dispose?this.params.options.dispose.apply(this):this.destroy&&this.destroy()}}]),l}}]);function F(){d(this,F)}var K=(t(S,[{key:"generate",value:function(e,t,n){var a=this.generates[n.type||r.norm];return a?a.generate(e,t,n):n}}]),S);function S(e){var t;d(this,S),this.option=e,this.generates=(n(t={},r.easyui,new A(this.option)),n(t,r.norm,new V(this.option)),t),function(e){e.components.register(s.CompPrefix+"messager",{viewModel:f,template:"<div></div>"}),e.components.register(s.CompPrefix+"dialogs",{viewModel:y,template:y.getTemplate()}),e.components.register(s.CompPrefix+"desktop",{viewModel:k,template:"<div></div>"})}(this.option.ko)}var z=(t(B,[{key:"getConfig",value:function(e,t){t(null)}},{key:"loadComponent",value:function(e,t,n){n(null)}},{key:"loadTemplate",value:function(e,t,n){n(null)}},{key:"loadViewModel",value:function(r,s,e){var u=this;e(function(t,e){var n=ko.contextFor(e.element),a=n.$root,o=new s(t,e,a,n.$data);o.activate&&o.activate(t,e);var i=u;return o.koDescendantsComplete=function(e){$.data(e,ko.contextFor(e.firstChild)),i.factory.generate(r,t,o)},o})}}]),B);function B(e){d(this,B),this.factory=e}var H=(p(I,i),t(I,[{key:"_setComp",value:function(n){var a;$.each(ko.unwrap(this.comps),function(e,t){t.show(!1),t.name==n.name&&t.id==n.id&&(a=t)}),a||(a=n,this.comps.push(a)),a.show(!0)}},{key:"paint",value:function(e){}},{key:"repaint",value:function(e){}},{key:"remove",value:function(n){var a,o="[object String]"!=Object.prototype.toString.call(n),e=ko.unwrap(this.comps);if($.each(e,function(e,t){(o&&n.name==t.name&&n.id==t.id||!o&&t.name==n)&&(a=t)}),a&&(a.show(!1),this.comps.remove(a)),0<(e=ko.unwrap(this.comps)).length){var i=!1;$.each(e,function(e,t){if(t.show())return!(i=!0)}),i||e[e.length-1].show(!0)}}},{key:"removeAll",value:function(){this.comps.removeAll()}},{key:"show",value:function(n){$.each(ko.unwrap(this.comps),function(e,t){ko.unwrap(n.name==t.name&&n.id==t.id)?t.show(!0):t.show(!1)})}}],[{key:"getTemplate",value:function(){return'<div class="components-wrap"><div class="components-header" data-bind="if:showHeader"><div class="components-titles" data-bind="foreach:comps" ><div class="title-item" data-bind="css:{active:show},click:$parent.show.bind($parent)" ><span data-bind="text:$data.title"></span><span class="icon-clear" data-bind="click:$parent.remove.bind($parent)" ></span></div></div></div><div class="components-list" data-bind="foreach:comps" ><div class="components-item" data-bind="component:$data,visible:show,attr:{id:$data.domId}" ></div></div></div>'}}]),I);function I(e){d(this,I);var n=c(this,(I.__proto__||Object.getPrototypeOf(I)).call(this,r.norm));return n.comps=ko.observableArray(),n.paramComp=e.comp,n.showHeader=e.showHeader||!1,n.paramComp&&n.paramComp.subscribe(function(e){var t={id:0,name:null,title:null,params:{},show:ko.observable(!1)};"string"==typeof e?t.name=t.title=e:(t.name=e.name,t.title=e.title||e.name,t.params=e.params||{},t.id=e.id||0),t.domId=ko.computed(function(){return"components-item"+this.id},t),n._setComp(t)}),n}e.use=function(e){var t=new o(e),n=new K(t);e.components.loaders.unshift(new z(n)),e.components.register(s.CompPrefix+"components",{viewModel:H,template:H.getTemplate()})},e.getContextFor=function(e){var t=$.data(e);return t?t.$data:null},Object.defineProperty(e,"__esModule",{value:!0})});
